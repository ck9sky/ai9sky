{% extends "chatgpt_api_py/layout.html" %}
{% settings_VERSION_CACHE_BUST as VERSION_CACHE_BUST %}
{% assign "?" as QM %}{% comment %} suppress url percent encoding "?" to "%3F" {% endcomment %}
{% load static %}
{% static "" as staticTag %}
{% cacheBusterFileNames as CB %}
{% load bootstrap4 %}
{% load chatgpt_api_py_tags %}

{% block css %}
	<link rel="stylesheet" href="{{ staticTag }}{{ CB.chatgpt_api_py_css }}">
{% endblock %}

{% comment %}
    ChatGPT API accessed using Python library module openai.
{% endcomment %}

{% block chatgpt_api_content %}
	<div class="chat-container">
        <div class="d-flex justify-content-center">
            <a href="{% url 'home-no-redirects' %}"
                    class="badge badge-primary mx-0 my-2 p-2"
                    tabindex="-1" role="button">
                <span class="m-0 p-0"
                    onmousedown="{% include '_inline_js_hndlr_span_mousedown.html' %}"
                    onkeydown="{% include '_inline_js_hndlr_span_anchor_keydown.html' %}"
                    onfocus="{% include '_inline_js_hndlr_span_focus.html' %}"
                    onblur="{% include '_inline_js_hndlr_span_blur.html' %}"
                    tabindex="0">Back to Main Page</span></a><br>
        </div>

<!-- ############## REMOVE? MODIFY? Not sure if and how this template is used ########### 11/11/23 -->
        <div class="chat-log">
    <!--   { % comment %} Dynamically rendered by javascript, createMessageInstance() { % endcomment %} ####### ? -->

<!-- ############# move back to javascript? ############### -->
{#            <div class="message-instance-container">#}
{#                <div class="message user-message">#}
{#                    <div class="content">#}
{#                        <div class="message-image"></div>#}
{#                        <p>{ { prompt }}</p>#}
{#                    </div>#}
{#                </div>#}
{#                <div class="message ai-message">#}
{#                    <div class="content">#}
{#                        <div class="message-image">#}
{#                            <img src="{{ staticTag }}img/icon/chatgpt-icon-150x150.png{{ QM }}{{ VERSION_CACHE_BUST }}" alt="">#}
{#                        </div>#}
{#                        <p class="thinking">{ { message }}</p>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}


        </div>


{% comment %}  <!-- ############ no, we do not need a 'hidden' form now ################## -->
        { % comment %}
            "API key" Form: Securely send my OpenAI API key to chatgpt_api_js.js.
            Hidden form to allow Django to send API key to JavaScript. This form is NOT part of the original
            Treehouse example video. It is security trick to hide API key (in LOCAL js variable). 11/5/23
        { % endcomment %}
        <form method="POST" action="{ % url 'chatgpt_api_js:chatgpt_api_js_test1' %}" style="display: none;">
            { % csrf_token %}
            <input type="submit">
        </form>
{% endcomment %}

        {% comment %}
            Prompt Form: Where user enters question for ChatGPT.
            THIS IS THE FORM FROM ORIGINAL TREEHOUSE VIDEO. Adapted for a Django template (WHICH requires a
            Django view and form and csrf token in order to not crash to browser. 11/5/23
        {% endcomment %}
        <div class="new-message" id="prompt-form">
            <form method="POST" action="{% url 'chatgpt_api_py:chatgpt_api_py_test1' %}">
                {% csrf_token %}
                {% comment %} Django form convention: name="prompt", id="id_prompt" {% endcomment %}
                    <!--suppress HtmlFormInputWithoutLabel -->
                <input type="text" name="prompt" id="id_prompt" placeholder="Send a message...">
            </form>
        </div>
        <script>
            iconStr = "{{ staticTag }}img/icon/chatgpt-icon-150x150.png{{ QM }}{{ VERSION_CACHE_BUST }}";
            prompt = "{{ prompt }}";
            message = "{{ message }}";
// ########### var fresh_page not needed? ##########
{#            { % if first_prompt %}#}
{#                first_prompt = true;#}
{#            { % else %}#}
{#                first_prompt = false;#}
{#            { % endif %}#}
        </script>
<!-- ############## REMOVE? MODIFY? Not sure if and how this template is used ########### 11/11/23 -->

	</div>
{% endblock %}

{% block javascript %}
	<script src="{{ staticTag }}{{ CB.chatgpt_api_py_js }}" defer></script>
{% endblock %}
